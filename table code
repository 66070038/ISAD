import tkinter as tk
from tkinter import messagebox
from tkcalendar import Calendar

class CalendarApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Calendar with Task Management")

        self.calendar = Calendar(root, selectmode='day')
        self.calendar.pack(pady=20)

        self.task_frame = tk.Frame(root)
        self.task_frame.pack(pady=10)

        self.task_label = tk.Label(self.task_frame, text="Task:")
        self.task_label.grid(row=0, column=0)

        self.task_entry = tk.Entry(self.task_frame, width=30)
        self.task_entry.grid(row=0, column=1)

        self.add_task_button = tk.Button(self.task_frame, text="Add Task", command=self.add_task)
        self.add_task_button.grid(row=0, column=2)

        self.tasks = {}
        self.update_button = tk.Button(root, text="Update Task", command=self.update_task)
        self.update_button.pack(pady=5)

        self.task_listbox = tk.Listbox(root, width=50)
        self.task_listbox.pack(pady=10)

        self.task_listbox.bind("<<ListboxSelect>>", self.on_task_select)

    def add_task(self):
        date = self.calendar.get_date()
        task = self.task_entry.get()

        if task:
            if date not in self.tasks:
                self.tasks[date] = []
            self.tasks[date].append(task)
            self.task_entry.delete(0, tk.END)
            self.refresh_task_listbox(date)
        else:
            messagebox.showwarning("Warning", "Please enter a task.")

    def refresh_task_listbox(self, date):
        self.task_listbox.delete(0, tk.END)
        if date in self.tasks:
            for task in self.tasks[date]:
                self.task_listbox.insert(tk.END, task)

    def on_task_select(self, event):
        selected_task_index = self.task_listbox.curselection()
        if selected_task_index:
            selected_task = self.task_listbox.get(selected_task_index)
            self.task_entry.delete(0, tk.END)
            self.task_entry.insert(0, selected_task)

    def update_task(self):
        date = self.calendar.get_date()
        selected_task_index = self.task_listbox.curselection()
        updated_task = self.task_entry.get()

        if selected_task_index and updated_task:
            task_index = selected_task_index[0]
            self.tasks[date][task_index] = updated_task
            self.refresh_task_listbox(date)
            self.task_entry.delete(0, tk.END)
        else:
            messagebox.showwarning("Warning", "Select a task to update and enter the new task.")

if __name__ == "__main__":
    root = tk.Tk()
    app = CalendarApp(root)
    root.mainloop()
